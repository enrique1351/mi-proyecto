# RESUMEN DETALLADO DEL SISTEMA DE TRADING - Para Futuras Conversaciones

## üìã INFORMACI√ìN GENERAL

**Nombre del Proyecto**: Quant Trading System (Sistema de Trading Cuantitativo Universal)
**Versi√≥n**: 1.0.0
**Lenguaje**: Python 3.10+
**Estado**: En Desarrollo Activo
**Repositorio**: https://github.com/enrique1351/mi-proyecto

## üéØ OBJETIVO DEL SISTEMA

Crear un bot de trading completamente automatizado, modular, escalable y seguro que:
- Opera 24/7 en m√∫ltiples mercados (crypto, acciones, forex)
- Se adapta autom√°ticamente a condiciones de mercado
- Gestiona riesgo de forma inteligente
- Utiliza IA y ML para optimizaci√≥n continua
- Env√≠a notificaciones en tiempo real
- Es desplegable en VPS/Cloud para operaci√≥n continua

## üèóÔ∏è ARQUITECTURA DEL SISTEMA

### Estructura de Directorios Principal

```
mi-proyecto/
‚îú‚îÄ‚îÄ shared/core/              # M√≥dulos core del sistema
‚îÇ   ‚îú‚îÄ‚îÄ ai/                   # AI Auditor
‚îÇ   ‚îú‚îÄ‚îÄ analysis/             # Market regime detection
‚îÇ   ‚îú‚îÄ‚îÄ backtesting/          # Backtesting engine
‚îÇ   ‚îú‚îÄ‚îÄ brokers/              # Binance y brokers principales
‚îÇ   ‚îú‚îÄ‚îÄ config/               # Configuraci√≥n y constantes
‚îÇ   ‚îú‚îÄ‚îÄ data/                 # Data management (ingestion, storage)
‚îÇ   ‚îú‚îÄ‚îÄ execution/            # Execution interface y √≥rdenes
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/           # System reporter y monitoreo
‚îÇ   ‚îú‚îÄ‚îÄ risk/                 # Risk manager y portfolio optimizer
‚îÇ   ‚îú‚îÄ‚îÄ security/             # Credential vault y seguridad
‚îÇ   ‚îî‚îÄ‚îÄ strategies/           # Strategy engine y adaptive manager
‚îÇ
‚îú‚îÄ‚îÄ trading/                  # NUEVO: M√≥dulo de trading
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ alpaca_broker.py      # Integraci√≥n Alpaca (acciones/ETFs)
‚îÇ   ‚îú‚îÄ‚îÄ forex_broker.py       # Integraci√≥n Oanda (forex)
‚îÇ   ‚îî‚îÄ‚îÄ broker_manager.py     # Gestor unificado de brokers
‚îÇ
‚îú‚îÄ‚îÄ notifications/            # NUEVO: Sistema de notificaciones
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ notification_manager.py    # Manager principal
‚îÇ   ‚îú‚îÄ‚îÄ telegram_notifier.py       # Telegram Bot API
‚îÇ   ‚îú‚îÄ‚îÄ email_notifier.py          # Email SMTP
‚îÇ   ‚îú‚îÄ‚îÄ sms_notifier.py            # Twilio SMS
‚îÇ   ‚îî‚îÄ‚îÄ pushbullet_notifier.py     # Pushbullet
‚îÇ
‚îú‚îÄ‚îÄ machine_learning/         # NUEVO: M√≥dulo de ML
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ time_series_models.py      # LSTM, ARIMA
‚îÇ   ‚îî‚îÄ‚îÄ nlp_analyzer.py            # BERT, sentiment analysis
‚îÇ
‚îú‚îÄ‚îÄ data_processing/          # NUEVO: Procesamiento de datos
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ data/                     # Datos persistentes
‚îÇ   ‚îú‚îÄ‚îÄ db/                   # SQLite databases
‚îÇ   ‚îú‚îÄ‚îÄ logs/                 # Log files
‚îÇ   ‚îî‚îÄ‚îÄ cache/                # Cache temporal
‚îÇ
‚îú‚îÄ‚îÄ tests/                    # Tests unitarios
‚îÇ   ‚îî‚îÄ‚îÄ unit/
‚îÇ
‚îú‚îÄ‚îÄ docker/                   # Configuraciones Docker
‚îÇ
‚îú‚îÄ‚îÄ main.py                   # Punto de entrada principal
‚îú‚îÄ‚îÄ requirements.txt          # Dependencias Python
‚îú‚îÄ‚îÄ Dockerfile               # Imagen Docker
‚îú‚îÄ‚îÄ docker-compose.prod.yml  # Deployment producci√≥n
‚îú‚îÄ‚îÄ .env.example             # Template de configuraci√≥n
‚îú‚îÄ‚îÄ .gitignore              # Git ignore
‚îî‚îÄ‚îÄ README.md               # Documentaci√≥n principal
```

## üîß M√ìDULOS IMPLEMENTADOS

### 1. M√ìDULOS CORE (shared/core/)

#### Data Management (shared/core/data/)
- **data_manager.py**: Gesti√≥n de datos con SQLite
- **data_ingestion.py**: Ingesta de datos de m√∫ltiples fuentes
- **database_manager.py**: Manager de base de datos
- **websocket_manager.py**: WebSocket para datos en tiempo real

#### Strategy Engine (shared/core/strategies/)
- **strategy_engine.py**: Motor de estrategias
- **adaptive_strategy_manager.py**: Adaptaci√≥n autom√°tica de estrategias

#### Risk Management (shared/core/risk/)
- **risk_manager.py**: Gesti√≥n de riesgo, drawdown, position sizing
- **portfolio_optimizer.py**: Optimizaci√≥n de portfolio

#### Execution (shared/core/execution/)
- **execution_interface.py**: Interface de ejecuci√≥n de √≥rdenes
- **advanced_orders.py**: √ìrdenes avanzadas (stop-loss, take-profit, trailing)

#### Security (shared/core/security/)
- **credential_vault.py**: Almacenamiento encriptado de credenciales

#### AI (shared/core/ai/)
- **ai_auditor.py**: Auditor√≠a inteligente del sistema

#### Analysis (shared/core/analysis/)
- **market_regime.py**: Detecci√≥n de r√©gimen de mercado (trending, ranging, volatile)

#### Brokers (shared/core/brokers/)
- **brokers.py**: Factory de brokers, MockBroker, integraci√≥n Binance

#### Monitoring (shared/core/monitoring/)
- **system_reporter.py**: Generaci√≥n de reportes y m√©tricas

### 2. M√ìDULO TRADING (trading/)

#### Alpaca Broker (trading/alpaca_broker.py)
**Funcionalidad**:
- Conexi√≥n con Alpaca Markets API
- Trading de acciones US y ETFs
- Soporta paper y live trading
- √ìrdenes: market, limit, stop, stop_limit
- Gesti√≥n de posiciones

**M√©todos principales**:
- `get_account()`: Info de cuenta
- `get_positions()`: Posiciones abiertas
- `place_order()`: Colocar orden
- `cancel_order()`: Cancelar orden
- `get_bars()`: Datos hist√≥ricos
- `close_position()`: Cerrar posici√≥n

#### Oanda/Forex Broker (trading/forex_broker.py)
**Funcionalidad**:
- Conexi√≥n con Oanda v20 API
- Trading de pares forex (EUR/USD, GBP/USD, etc.)
- CFDs
- Practice y live accounts

**M√©todos principales**:
- `get_account()`: Info de cuenta
- `get_positions()`: Posiciones
- `place_order()`: Colocar orden con TP/SL
- `get_historical_data()`: Datos hist√≥ricos
- `close_position()`: Cerrar posici√≥n

#### Broker Manager (trading/broker_manager.py)
**Funcionalidad**:
- Gesti√≥n unificada de m√∫ltiples brokers
- Interface com√∫n para todos los brokers
- Health check de brokers

**Brokers soportados**:
- Binance (crypto)
- Alpaca (stocks)
- Oanda (forex)
- Interactive Brokers (futuro)
- Coinbase (futuro)

### 3. M√ìDULO NOTIFICATIONS (notifications/)

#### Notification Manager (notifications/notification_manager.py)
**Funcionalidad**:
- Gesti√≥n centralizada de notificaciones
- Soporte para m√∫ltiples canales
- Niveles de notificaci√≥n (INFO, WARNING, ERROR, CRITICAL)
- Templates para alertas comunes

**Canales soportados**:
- Telegram
- Email
- SMS
- Pushbullet

**M√©todos principales**:
- `send()`: Enviar notificaci√≥n
- `send_trade_alert()`: Alerta de trade
- `send_error_alert()`: Alerta de error
- `send_daily_summary()`: Resumen diario
- `health_check()`: Estado de canales

#### Telegram Notifier (notifications/telegram_notifier.py)
- Env√≠o de mensajes v√≠a Telegram Bot API
- Soporta emojis seg√∫n nivel de prioridad
- Env√≠o de documentos y fotos

#### Email Notifier (notifications/email_notifier.py)
- Env√≠o v√≠a SMTP
- Soporta HTML y texto plano
- Compatible con Gmail, Outlook, etc.

#### SMS Notifier (notifications/sms_notifier.py)
- Env√≠o de SMS v√≠a Twilio
- Truncado autom√°tico a 160 caracteres

#### Pushbullet Notifier (notifications/pushbullet_notifier.py)
- Push notifications v√≠a Pushbullet API
- Soporta links y notas

### 4. M√ìDULO MACHINE LEARNING (machine_learning/)

#### Time Series Models (machine_learning/time_series_models.py)
**Modelos implementados**:

1. **LSTM Predictor**
   - Red neuronal LSTM para predicci√≥n de precios
   - Arquitectura: 3 capas LSTM + Dropout + Dense
   - Optimizador: Adam
   - Loss: MSE
   - M√©todos: `train()`, `predict()`, `save()`, `load()`

2. **ARIMA Predictor**
   - Modelo ARIMA cl√°sico para series temporales
   - Configurable (p, d, q)
   - M√©todos: `train()`, `predict()`, `save()`, `load()`

#### NLP Analyzer (machine_learning/nlp_analyzer.py)
**Componentes**:

1. **NewsAnalyzer**
   - An√°lisis de sentimiento con FinBERT
   - Named Entity Recognition (NER)
   - Agregaci√≥n de sentimiento de mercado
   - M√©todos:
     - `analyze_sentiment()`: Analizar un texto
     - `analyze_news_batch()`: Batch de noticias
     - `extract_entities()`: Extraer entidades
     - `get_market_sentiment()`: Sentimiento general

2. **NewsAggregator**
   - Obtenci√≥n de noticias de m√∫ltiples fuentes
   - APIs: CryptoPanic, NewsAPI
   - M√©todos:
     - `fetch_crypto_news()`: Noticias crypto
     - `fetch_stock_news()`: Noticias de acciones

## üì¶ DEPENDENCIAS PRINCIPALES

### Core Dependencies
- numpy==1.24.3
- pandas==2.0.3
- scipy==1.11.1

### Data & APIs
- requests==2.31.0
- ccxt==4.0.0 (crypto exchanges)
- yfinance==0.2.28

### Databases
- SQLAlchemy==2.0.19
- psycopg2-binary==2.9.7
- redis==4.6.0

### Technical Analysis
- ta-lib==0.4.28
- pandas-ta==0.3.14b0

### Machine Learning
- scikit-learn==1.3.0
- tensorflow==2.13.0
- torch==2.0.1
- statsmodels==0.14.0

### Broker APIs
- alpaca-trade-api==3.0.2
- oandapyV20==0.7.2

### Notifications
- twilio==8.10.0

### NLP
- transformers==4.35.0
- sentencepiece==0.1.99

### Security
- cryptography==41.0.3
- pycryptodome==3.18.0

### Utils
- python-dotenv==1.0.0
- pyyaml==6.0.1
- tqdm==4.66.1
- schedule==1.2.0

## üîê CONFIGURACI√ìN (.env)

### Variables de Entorno Principales

```bash
# Crypto Exchanges
BINANCE_API_KEY=
BINANCE_API_SECRET=

# Stock Brokers
ALPACA_API_KEY=
ALPACA_API_SECRET=
ALPACA_BASE_URL=https://paper-api.alpaca.markets

# Forex Brokers
OANDA_API_KEY=
OANDA_ACCOUNT_ID=
OANDA_PRACTICE=true

# Notifications
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_FROM_NUMBER=
TWILIO_TO_NUMBER=
PUSHBULLET_TOKEN=

# Security
VAULT_SECRET=

# System
ENVIRONMENT=local
LOG_LEVEL=INFO
TRADING_MODE=paper
INITIAL_CAPITAL=10000
```

## üöÄ DEPLOYMENT

### Local Development
```bash
python main.py --mode paper --capital 10000 --cycles 10
```

### Docker
```bash
docker build -t trading-bot .
docker run -d --env-file .env trading-bot
```

### Docker Compose (Producci√≥n)
```bash
docker-compose -f docker-compose.prod.yml up -d
```

### VPS (DigitalOcean/AWS)
1. Crear VPS Ubuntu 22.04
2. Instalar Docker
3. Clonar repo
4. Configurar .env
5. Deploy con docker-compose

### Ejecutable (PyInstaller)
```bash
pyinstaller --onefile main.py
# Ejecutable en dist/
```

## üìä FLUJO DE EJECUCI√ìN

### Ciclo Principal (main.py -> QuantTradingSystem.run_single_cycle())

1. **Verificar Kill-Switch**
   - Revisar si el sistema debe detenerse

2. **Ingerir Datos**
   - Obtener datos de mercado actualizados
   - Actualizar base de datos

3. **Detectar R√©gimen de Mercado**
   - Analizar volatilidad, tendencia
   - Clasificar: trending, ranging, volatile

4. **Generar Se√±ales**
   - Strategy Engine genera se√±ales crudas
   - M√∫ltiples estrategias en paralelo

5. **Adaptar Se√±ales**
   - Adaptive Manager ajusta seg√∫n r√©gimen
   - Considera performance hist√≥rica

6. **Filtrar por Riesgo**
   - Risk Manager valida se√±ales
   - Verifica: drawdown, exposici√≥n, correlaci√≥n

7. **Ejecutar √ìrdenes**
   - Execution Interface coloca √≥rdenes
   - Routing a broker apropiado

8. **Auditor√≠a IA**
   - AI Auditor revisa decisiones
   - Detecta anomal√≠as

9. **Notificaciones**
   - Enviar alertas de trades
   - Reportar errores si existen

10. **Actualizar M√©tricas**
    - Guardar estad√≠sticas
    - Preparar siguiente ciclo

## üîî SISTEMA DE NOTIFICACIONES

### Tipos de Notificaciones

1. **Trade Alerts**
   - Cuando se ejecuta un trade
   - Info: symbol, side, quantity, price

2. **Error Alerts**
   - Errores cr√≠ticos del sistema
   - Nivel: ERROR o CRITICAL

3. **Daily Summary**
   - Resumen al final del d√≠a
   - PnL, trades, win rate

4. **Custom Alerts**
   - Alerts personalizadas seg√∫n necesidad

### Canales y Uso

- **Telegram**: Todas las notificaciones (default)
- **Email**: Reportes detallados, res√∫menes
- **SMS**: Solo WARNING+ (cr√≠ticas)
- **Pushbullet**: Notificaciones push generales

## ü§ñ MACHINE LEARNING

### Modelos de Time Series

**LSTM**:
- Input: Secuencias de precios hist√≥ricos (default 60 timesteps)
- Output: Predicci√≥n del siguiente precio
- Uso: Predicci√≥n de tendencias a corto/medio plazo

**ARIMA**:
- Input: Serie temporal de precios
- Output: Forecasting N pasos adelante
- Uso: An√°lisis de tendencias, estacionalidad

### NLP para News

**FinBERT**:
- Modelo BERT entrenado en textos financieros
- Clasificaci√≥n: positive, negative, neutral
- Confidence score

**NER (Named Entity Recognition)**:
- Extracci√≥n de entidades (empresas, personas, ubicaciones)
- Filtrado de noticias relevantes

**Market Sentiment**:
- Agregaci√≥n de sentimiento de m√∫ltiples noticias
- Score global: -1 (muy negativo) a +1 (muy positivo)

## üîí SEGURIDAD

### Credential Vault
- Encriptaci√≥n AES-256
- Hardware fingerprint
- Rotaci√≥n de claves

### API Security
- Rate limiting
- Request signing
- IP whitelist (cuando disponible)

### Cloud Secrets (Futuro)
- Azure KeyVault
- AWS Secrets Manager

## üìà M√âTRICAS Y REPORTES

### M√©tricas Clave
- PnL (Profit and Loss)
- Win Rate
- Sharpe Ratio
- Max Drawdown
- Total Trades
- Success Rate

### Formatos de Reporte
- JSON (program√°tico)
- CSV (an√°lisis)
- HTML (visualizaci√≥n)
- Logs (debugging)

## üß™ TESTING

### Estructura de Tests
```
tests/
‚îú‚îÄ‚îÄ unit/
‚îÇ   ‚îú‚îÄ‚îÄ test_notifications.py
‚îÇ   ‚îú‚îÄ‚îÄ test_trading.py
‚îÇ   ‚îú‚îÄ‚îÄ test_ml.py
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ integration/
‚îî‚îÄ‚îÄ conftest.py
```

### Comandos
```bash
# Run all tests
pytest

# With coverage
pytest --cov=shared --cov=trading --cov=notifications --cov=machine_learning

# Specific test
pytest tests/unit/test_notifications.py
```

## üó∫Ô∏è ROADMAP

### ‚úÖ Fase 1 Completada (Esta Implementaci√≥n)
- Modularizaci√≥n completa
- Integraci√≥n Alpaca (stocks)
- Integraci√≥n Oanda (forex)
- Sistema completo de notificaciones (Telegram, Email, SMS, Pushbullet)
- Modelos ML (LSTM, ARIMA, BERT/NLP)
- Dockerizaci√≥n
- README y documentaci√≥n completa
- .gitignore

### üöß Fase 2 En Progreso
- Interactive Brokers integration
- Coinbase Advanced Trade
- Dashboard web (Streamlit/Dash)
- Backtesting engine mejorado
- Tests unitarios completos

### üîÆ Fase 3 Futuro
- Options trading
- Multi-account management
- Advanced ML (Reinforcement Learning)
- Kubernetes deployment
- API REST para control remoto
- Mobile app

## üí° MEJORAS SUGERIDAS PARA PR√ìXIMAS ITERACIONES

1. **Testing**
   - Agregar tests unitarios para todos los m√≥dulos nuevos
   - Tests de integraci√≥n para brokers
   - Tests E2E para flujo completo

2. **Dashboard**
   - Crear dashboard web con Streamlit
   - Visualizaci√≥n en tiempo real
   - Control manual de trades

3. **Backtesting**
   - Mejorar backtesting engine
   - Walk-forward analysis
   - Monte Carlo simulation

4. **ML**
   - Entrenar modelos con datos hist√≥ricos propios
   - Implementar model versioning
   - A/B testing de modelos

5. **Monitoring**
   - Integrar Prometheus metrics
   - Grafana dashboards
   - Alerting avanzado

6. **Documentation**
   - API documentation (Swagger)
   - Video tutorials
   - Examples repository

## üéì CONCEPTOS CLAVE PARA ENTENDER EL SISTEMA

### Market Regime
Estado del mercado: trending (tendencia clara), ranging (lateral), volatile (alta volatilidad)

### Adaptive Strategy
Estrategias que se ajustan autom√°ticamente seg√∫n el r√©gimen de mercado y performance

### Position Sizing
C√°lculo del tama√±o de posici√≥n: Kelly Criterion, Volatility-based, Risk Parity

### Kill-Switch
Sistema de emergencia que detiene el trading ante condiciones peligrosas

### Paper Trading
Simulaci√≥n de trading con dinero virtual para testing

## üìû COMANDOS √öTILES

```bash
# Development
python main.py --mode paper --capital 10000 --cycles 10 --interval 30

# Production
python main.py --mode real --capital 5000 --cycles 1000 --interval 60 --ai

# Docker build
docker build -t trading-bot .

# Docker run
docker run -d --name bot --env-file .env trading-bot

# Docker Compose
docker-compose -f docker-compose.prod.yml up -d

# View logs
docker logs -f bot
docker-compose -f docker-compose.prod.yml logs -f trading-bot

# Tests
pytest
pytest --cov
pytest -v tests/unit/test_notifications.py

# PyInstaller
pyinstaller --onefile main.py
```

## üîç TROUBLESHOOTING COM√öN

### Error: "Module not found"
```bash
pip install -r requirements.txt
```

### Error: "TA-Lib not installed"
Seguir instrucciones de instalaci√≥n de TA-Lib en README

### Error: "Telegram bot not responding"
Verificar TELEGRAM_BOT_TOKEN y TELEGRAM_CHAT_ID en .env

### Error: "Alpaca authentication failed"
Verificar ALPACA_API_KEY y ALPACA_API_SECRET

### Error: "Out of memory"
Reducir batch size en ML models o limitar n√∫mero de assets

## üìù NOTAS IMPORTANTES

1. **NUNCA** commitear .env con credenciales reales
2. **SIEMPRE** testear en paper mode antes de real trading
3. **MANTENER** logs para debugging
4. **MONITOREAR** m√©tricas de performance constantemente
5. **ACTUALIZAR** documentaci√≥n cuando se agreguen features

## üéØ PARA LA PR√ìXIMA CONVERSACI√ìN

Cuando retomes este proyecto, recuerda:

1. **Estado actual**: Sistema modularizado con todos los componentes base implementados
2. **Prioridad**: Testing y validaci√≥n de componentes
3. **Siguiente paso**: Implementar tests unitarios y de integraci√≥n
4. **Pendiente**: Dashboard web para monitoreo
5. **Futuro**: Interactive Brokers, options trading

---

**√öltima actualizaci√≥n**: 2026-01-21
**Versi√≥n del documento**: 1.0
**Autor**: Sistema de Trading Cuantitativo

---

Este documento contiene toda la informaci√≥n necesaria para continuar el desarrollo del sistema en futuras conversaciones. Incluye arquitectura, m√≥dulos implementados, configuraci√≥n, y gu√≠a de uso.
